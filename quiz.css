/* ========== Root Theme & Reset ========== */
:root {
  --font-family: 'Prompt', system-ui, sans-serif;
  --color-bg: #fff8f8;
  --color-bg-alt: #ffe5e5;
  --color-surface: #ffffff;
  --color-border: #f7c9c9;
  --color-text: #5a1d1d;
  --color-text-soft: #7d3a3a;
  --color-primary: #dc2626;
  --color-primary-accent: #f87171;
  --color-accent: #fb923c;
  --color-success: #16a34a;
  --color-warning: #d97706;
  --color-danger: #dc2626;
  --color-focus: #fb923c;
  --radius-sm: 6px;
  --radius-md: 14px;
  --radius-lg: 22px;
  --shadow-sm: 0 4px 10px -2px rgba(0,0,0,.04), 0 2px 4px -1px rgba(0,0,0,.04);
  --shadow-md: 0 6px 22px -4px rgba(220,38,38,.25), 0 3px 10px -2px rgba(0,0,0,.08);
  --shadow-focus: 0 0 0 4px rgba(251,146,60,.35);
  --trans-fast: .18s cubic-bezier(.4,0,.2,1);
  --trans-slow: .4s cubic-bezier(.25,.8,.25,1);
  --max-width: 880px;
}

[data-theme="dark"] {
  --color-bg: #171717;
  --color-bg-alt: #1f1f1f;
  --color-surface: #242424;
  --color-border: #3b3b3b;
  --color-text: #f3f3f3;
  --color-text-soft: #d1c3c3;
  --color-primary: #f87171;
  --color-primary-accent: #fb7185;
  --color-accent: #fb923c;
  --shadow-md: 0 6px 22px -4px rgba(0,0,0,.55), 0 3px 10px -2px rgba(0,0,0,.55);
  --shadow-sm: 0 4px 10px -2px rgba(0,0,0,.5), 0 2px 4px -1px rgba(0,0,0,.5);
  --shadow-focus: 0 0 0 4px rgba(251,146,60,.45);
}

* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html {
  scroll-behavior: smooth;
}

body {
  margin: 0;
  font-family: var(--font-family);
  background:
    radial-gradient(at 10% 15%, var(--color-bg-alt) 0%, transparent 60%),
    radial-gradient(at 90% 80%, var(--color-bg-alt) 0%, transparent 55%),
    linear-gradient(135deg, var(--color-bg), var(--color-bg-alt));
  color: var(--color-text);
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  padding: clamp(1rem, 2.5vw, 2.25rem);
  transition: background-color var(--trans-slow), color var(--trans-fast);
  overflow-x: hidden;
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce) {
  * {
    animation: none !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
}

/* Typography utilities */
h1,h2,h3 {
  line-height: 1.15;
  font-weight: 700;
  letter-spacing: .5px;
  margin: 0;
}

p {
  line-height: 1.55;
  margin: .75rem 0 1rem;
}

a {
  color: var(--color-primary);
  text-decoration: none;
  transition: color var(--trans-fast);
}
a:hover {
  color: var(--color-accent);
}

/* ========== Header ========== */
.app-header {
  width: 100%;
  max-width: var(--max-width);
  margin: 0 auto 1.75rem;
  background: linear-gradient(110deg, var(--color-primary) 0%, var(--color-primary-accent) 55%, var(--color-accent) 110%);
  color: #fff;
  padding: clamp(1rem, 2vw, 1.5rem) clamp(1rem, 2vw, 1.75rem);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  position: relative;
  overflow: hidden;
  display: flex;
  flex-wrap: wrap;
  gap: 1.25rem;
  align-items: center;
  justify-content: space-between;
  isolation: isolate;
}

.app-header::before,
.app-header::after {
  content: '';
  position: absolute;
  inset: 0;
  background:
    radial-gradient(circle at 25% 15%, rgba(255,255,255,.25), transparent 60%),
    radial-gradient(circle at 85% 75%, rgba(255,255,255,.18), transparent 65%);
  mix-blend-mode: overlay;
  opacity: .9;
  pointer-events: none;
  z-index: -1;
}

.header-left {
  display: flex;
  gap: .9rem;
  align-items: center;
}

.header-icon {
  background: rgba(255,255,255,.15);
  backdrop-filter: blur(4px);
  width: 56px;
  height: 56px;
  display: grid;
  place-items: center;
  border-radius: 18px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.35);
  position: relative;
  overflow: hidden;
}

.header-icon::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(145deg, rgba(255,255,255,.35), transparent 60%);
  mix-blend-mode: overlay;
}

.header-title-wrap {
  display: flex;
  flex-direction: column;
  gap: .3rem;
}

.header-title {
  font-size: clamp(1.35rem, 2.8vw, 2rem);
  font-weight: 700;
  margin: 0;
}

.header-sub {
  font-size: .9rem;
  opacity: .9;
  letter-spacing: .5px;
  font-weight: 500;
}

/* Theme Toggle */
.theme-toggle {
  appearance: none;
  border: none;
  background: var(--color-surface);
  color: var(--color-text);
  padding: .65rem 1rem;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: .55rem;
  font-weight: 600;
  font-size: .9rem;
  position: relative;
  transition: background var(--trans-fast), transform var(--trans-fast);
}
.theme-toggle:hover {
  background: var(--color-primary-accent);
  color: #fff;
  transform: translateY(-2px);
}
.theme-toggle:active {
  transform: translateY(0);
}
.theme-toggle:focus-visible {
  outline: none;
  box-shadow: var(--shadow-focus);
}

/* Back link */
.back-link {
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  font-weight: 600;
  color: #fff;
  padding: .6rem 1rem;
  border-radius: var(--radius-md);
  background: rgba(255,255,255,.16);
  backdrop-filter: blur(3px);
  transition: background var(--trans-fast), transform var(--trans-fast);
}
.back-link:hover {
  background: rgba(255,255,255,.28);
  transform: translateY(-2px);
}
.back-link:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(255,255,255,.5);
}

/* Progress Bar */
.progress-track {
  position: fixed;
  top: 0;
  left: 0;
  height: 5px;
  width: 100%;
  background: linear-gradient(to right, var(--color-bg-alt), var(--color-bg));
  z-index: 900;
}
.progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--color-primary), var(--color-accent), var(--color-success));
  background-size: 200% 100%;
  animation: progressFlow 8s linear infinite;
  transition: width .4s var(--trans-fast);
  box-shadow: 0 0 0 1px rgba(0,0,0,.05), 0 4px 10px -2px rgba(0,0,0,.25);
}
@keyframes progressFlow {
  0% { background-position: 0% 50%;}
  100% { background-position: 200% 50%;}
}

/* ========== Layout ========== */
main {
  width: 100%;
  max-width: var(--max-width);
  margin: 0 auto 4rem;
}

.quiz-intro {
  background: var(--color-surface);
  padding: 1.35rem 1.5rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  margin-bottom: 1.75rem;
  border: 1px solid var(--color-border);
  font-size: .95rem;
}

.quiz-grid {
  display: grid;
  gap: 1.4rem;
}

/* ========== Quiz Card ========== */
.quiz-card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: 1.3rem 1.35rem 1.4rem;
  position: relative;
  box-shadow: var(--shadow-sm);
  display: flex;
  flex-direction: column;
  gap: .9rem;
  overflow: hidden;
  isolation: isolate;
  transition: box-shadow var(--trans-fast), transform var(--trans-fast), border-color var(--trans-fast);
}

.quiz-card::before {
  content: attr(data-number);
  position: absolute;
  top: -8px;
  right: 8px;
  font-size: clamp(2.3rem, 7vw, 3.6rem);
  font-weight: 800;
  color: var(--color-primary);
  opacity: .07;
  z-index: -1;
  pointer-events: none;
  letter-spacing: -4px;
}

.quiz-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-3px);
  border-color: var(--color-primary-accent);
}

.quiz-card[data-status="correct"] {
  border-color: var(--color-success);
  animation: pulseCorrect 1.1s ease;
}
.quiz-card[data-status="wrong"] {
  border-color: var(--color-danger);
  animation: shakeWrong .5s ease;
}

@keyframes pulseCorrect {
  0% { box-shadow: 0 0 0 0 rgba(22,163,74,.4);}
  70% { box-shadow: 0 0 0 8px rgba(22,163,74,0);}
  100% { box-shadow: 0 0 0 0 rgba(22,163,74,0);}
}
@keyframes shakeWrong {
  10%, 90% { transform: translateX(-2px);}
  20%, 80% { transform: translateX(4px);}
  30%, 50%, 70% { transform: translateX(-6px);}
  40%, 60% { transform: translateX(6px);}
}

/* Question text */
.quiz-q {
  font-weight: 600;
  font-size: 1.02rem;
  margin: 0;
  color: var(--color-text);
}

/* Options */
.options {
  list-style: none;
  padding: 0;
  margin: .3rem 0 0;
  display: flex;
  flex-direction: column;
  gap: .55rem;
}

.option {
  position: relative;
  display: flex;
}

.option input {
  position: absolute;
  opacity: 0;
  inset: 0;
  cursor: pointer;
}

.option-label {
  --pad-y: .75rem;
  --pad-x: .85rem;
  padding: var(--pad-y) var(--pad-x);
  background: linear-gradient(140deg, var(--color-bg) 0%, var(--color-surface) 90%);
  border: 1.5px solid var(--color-border);
  border-radius: var(--radius-md);
  width: 100%;
  font-size: .93rem;
  font-weight: 500;
  letter-spacing: .3px;
  display: flex;
  gap: .65rem;
  align-items: flex-start;
  line-height: 1.4;
  position: relative;
  transition: background var(--trans-fast), border-color var(--trans-fast), transform var(--trans-fast), box-shadow var(--trans-fast);
}

.option-label::before {
  content: '';
  width: 20px;
  height: 20px;
  flex: 0 0 20px;
  margin-top: 2px;
  border: 2px solid var(--color-primary);
  border-radius: 50%;
  display: inline-block;
  position: relative;
  box-shadow: inset 0 0 0 3px var(--color-surface);
  background: var(--color-surface);
  transition: background var(--trans-fast), transform var(--trans-fast), box-shadow var(--trans-fast);
}

.option input:focus-visible + .option-label {
  outline: none;
  box-shadow: var(--shadow-focus);
  transform: translateY(-2px);
}

.option input:hover + .option-label {
  background: var(--color-bg-alt);
  border-color: var(--color-primary-accent);
}

.option input:checked + .option-label {
  border-color: var(--color-primary);
  background: linear-gradient(140deg, var(--color-primary-accent) 0%, var(--color-primary) 90%);
  color: #fff;
  box-shadow: 0 4px 14px -3px rgba(220,38,38,.55);
}

.option input:checked + .option-label::before {
  background: #fff;
  border-color: #fff;
  box-shadow: 0 0 0 5px var(--color-primary) inset, 0 0 0 1px var(--color-primary);
}

/* Feedback Badges */
.feedback {
  margin-top: .3rem;
  font-size: .78rem;
  font-weight: 600;
  letter-spacing: .5px;
  text-transform: uppercase;
  display: inline-flex;
  align-items: center;
  gap: .35rem;
  padding: .35rem .6rem;
  border-radius: 100px;
  background: var(--color-bg-alt);
  color: var(--color-text-soft);
  border: 1px solid var(--color-border);
  opacity: 0;
  transform: translateY(-6px);
  animation: fadeSlideIn .55s forwards;
}

.quiz-card[data-status="correct"] .feedback {
  background: rgba(22,163,74,.12);
  border-color: rgba(22,163,74,.5);
  color: var(--color-success);
}
.quiz-card[data-status="wrong"] .feedback {
  background: rgba(220,38,38,.12);
  border-color: rgba(220,38,38,.5);
  color: var(--color-danger);
}

@keyframes fadeSlideIn {
  to { opacity: 1; transform: translateY(0);}
}

/* ========== Action Area ========== */
.actions {
  margin: 2.4rem 0 0;
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: center;
}

.button {
  --btn-bg: var(--color-primary);
  --btn-bg-hover: var(--color-primary-accent);
  --btn-color: #fff;
  appearance: none;
  border: none;
  background: linear-gradient(120deg, var(--btn-bg), var(--btn-bg-hover));
  color: var(--btn-color);
  padding: .95rem 1.8rem;
  font-weight: 600;
  letter-spacing: .5px;
  font-size: .95rem;
  border-radius: 50px;
  cursor: pointer;
  min-width: 180px;
  box-shadow: 0 10px 25px -8px rgba(220,38,38,.65);
  position: relative;
  overflow: hidden;
  transition: transform var(--trans-fast), box-shadow var(--trans-fast), background-position .6s;
  background-size: 180% 100%;
}
.button:hover { 
  transform: translateY(-4px);
  background-position: 100% 50%;
  box-shadow: 0 14px 30px -8px rgba(220,38,38,.75);
}
.button:active {
  transform: translateY(0);
}
.button:focus-visible {
  outline: none;
  box-shadow: var(--shadow-focus);
}
.button.secondary {
  --btn-bg: var(--color-bg-alt);
  --btn-bg-hover: var(--color-primary-accent);
  --btn-color: var(--color-text);
  color: var(--color-text);
  box-shadow: 0 6px 18px -4px rgba(0,0,0,.15);
}
.button.secondary:hover {
  color: #fff;
}

.button.outline {
  background: transparent;
  border: 2px solid var(--color-primary);
  color: var(--color-primary);
  box-shadow: none;
  --btn-bg: transparent;
  --btn-bg-hover: transparent;
}
.button.outline:hover {
  background: var(--color-primary);
  color: #fff;
  box-shadow: 0 8px 22px -6px rgba(220,38,38,.65);
}

/* Loading spinner */
.button .spinner {
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.4);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  display: none;
}
.button.loading {
  pointer-events: none;
  opacity: .85;
}
.button.loading .spinner {
  display: inline-block;
}
@keyframes spin {
  to { transform: rotate(360deg);}
}

/* ========== Result Box ========== */
.result {
  margin-top: 3rem;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  padding: 2rem 1.75rem 2.4rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  position: relative;
  overflow: hidden;
  animation: fadeResult .7s var(--trans-fast);
}

@keyframes fadeResult {
  from { opacity: 0; transform: translateY(25px);}
  to { opacity: 1; transform: translateY(0);}
}

.result::before {
  content: '';
  position: absolute;
  inset: 0;
  background:
    linear-gradient(120deg, var(--color-primary) 0%, var(--color-accent) 50%, var(--color-success) 100%);
  opacity: .08;
  pointer-events: none;
  mix-blend-mode: soft-light;
}

.score {
  font-size: clamp(1.6rem, 3.8vw, 2.6rem);
  font-weight: 800;
  background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
  -webkit-background-clip: text;
  color: transparent;
  letter-spacing: 1px;
  margin: .75rem 0 1.25rem;
  text-shadow: 0 10px 35px rgba(0,0,0,.15);
}

.performance {
  font-weight: 600;
  font-size: 1rem;
  padding: .75rem 1rem;
  border-radius: var(--radius-md);
  background: var(--color-bg-alt);
  border: 1px solid var(--color-border);
  display: inline-flex;
  align-items: center;
  gap: .55rem;
  margin-top: .4rem;
}

.performance.good { 
  background: rgba(22,163,74,.12);
  border-color: rgba(22,163,74,.5);
  color: var(--color-success);
}
.performance.ok {
  background: rgba(217,119,6,.12);
  border-color: rgba(217,119,6,.5);
  color: var(--color-warning);
}
.performance.bad {
  background: rgba(220,38,38,.12);
  border-color: rgba(220,38,38,.5);
  color: var(--color-danger);
}

.answers-list {
  margin: 1.2rem 0 1.6rem;
  padding: 0;
  list-style: none;
  display: grid;
  gap: .5rem;
  font-size: .88rem;
}

.answers-list li {
  display: flex;
  flex-wrap: wrap;
  gap: .45rem;
  align-items: center;
  padding: .55rem .75rem;
  background: var(--color-bg);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  line-height: 1.3;
}

.answers-list .tag {
  font-size: .65rem;
  font-weight: 700;
  letter-spacing: .4px;
  padding: .25rem .5rem;
  border-radius: 6px;
  text-transform: uppercase;
  background: var(--color-bg-alt);
  color: var(--color-text-soft);
}

.answers-list .tag.correct {
  background: rgba(22,163,74,.15);
  color: var(--color-success);
  border: 1px solid rgba(22,163,74,.4);
}
.answers-list .tag.wrong {
  background: rgba(220,38,38,.15);
  color: var(--color-danger);
  border: 1px solid rgba(220,38,38,.4);
}
.answers-list .tag.missed {
  background: rgba(217,119,6,.15);
  color: var(--color-warning);
  border: 1px solid rgba(217,119,6,.4);
}

/* ========== Confetti Canvas ========== */
#confettiCanvas {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 1000;
}

/* Accessibility live region */
#liveRegion {
  position: absolute;
  width: 1px;
  height: 1px;
  overflow: hidden;
  clip: rect(0 0 0 0);
  white-space: nowrap;
  clip-path: inset(50%);
}

/* ========== Responsive ========== */
@media (max-width: 640px) {
  body {
    padding: 1rem .9rem 3rem;
  }
  .app-header {
    padding: 1.1rem 1.2rem 1.2rem;
  }
  .quiz-card {
    padding: 1.05rem 1.05rem 1.2rem;
  }
  .option-label {
    font-size: .9rem;
  }
  .answers-list {
    font-size: .8rem;
  }
}

/* Scrollbar styling (webkit) */
::-webkit-scrollbar {
  width: 10px;
}
::-webkit-scrollbar-track {
  background: var(--color-bg-alt);
}
::-webkit-scrollbar-thumb {
  background: var(--color-primary-accent);
  border-radius: 30px;
  border: 2px solid var(--color-bg-alt);
}
::-webkit-scrollbar-thumb:hover {
  background: var(--color-primary);
}

/* Dark theme subtle border glow */
[data-theme="dark"] .quiz-card:hover {
  box-shadow: 0 10px 28px -6px rgba(0,0,0,.7), 0 0 0 1px rgba(255,255,255,.03);
}