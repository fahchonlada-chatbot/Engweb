<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สมัครสมาชิก / เข้าสู่ระบบ - EnglishClassroom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #0d1117;
            margin: 0;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }


        .hero-section {
            background-color: #1a202c; 
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        .tab-active {
            color: #ef4444 !important;
            border-bottom: 3px solid #ef4444;
            font-weight: 600;
        }

        .tab-inactive {
            color: #9ca3af;
        }

        input:focus {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.3) !important;
            outline: none;
        }

        .gradient-button {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            transition: all 0.3s ease;
        }
        .gradient-button:hover {
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            transform: translateY(-2px);
        }

        .alert {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        
    </style>
</head>
<body class="bg-gray-900 min-h-screen">
    
    <div class="relative w-full min-h-screen flex flex-col text-white hero-section">
        <div class="absolute inset-0 z-0 flex items-center justify-center overflow-hidden">
            <img src="engback.png" onerror="this.onerror=null; this.src='https://placehold.co/1920x1080/1a202c/ffffff?text=English+Classroom+Background';" alt="Students in an English class" class="w-full h-full object-cover opacity-30 blur-sm">
        </div>
        
        <header class="relative top-0 left-0 right-0 py-2 px-6 flex justify-between items-center z-30 bg-red-600 bg-opacity-80 backdrop-blur-sm">
            <div class="flex items-center space-x-3">
                <img src="Logo.JPG" alt="Main Logo" class="rounded-full shadow-2xl ring-4 w-11 h-11" onerror="this.onerror=null; this.src='https://placehold.co/44x44/dc2626/ffffff?text=Logo';">
                <a href="home.html" class="text-xl font-extrabold text-gray-100 hover:text-red-300 transition-colors duration-300">EnglishClassroom</a>
            </div>
        </header>

        <!-- Main Content -->
        <div class="relative z-20 flex-1 flex items-center justify-center px-4 py-8">
            <div class="glass-card rounded-2xl p-8 w-full max-w-md">
                <!-- Alert Messages -->
                <div id="alertBox" class="hidden mb-4 p-4 rounded-lg"></div>

                <!-- Tab Navigation -->
                <div class="flex border-b border-gray-600 mb-6">
                    <button id="loginTab" class="tab-active flex-1 py-3 text-center transition-all duration-300" onclick="switchTab('login')">
                        เข้าสู่ระบบ
                    </button>
                    <button id="registerTab" class="tab-inactive flex-1 py-3 text-center transition-all duration-300" onclick="switchTab('register')">
                        สมัครสมาชิก
                    </button>
                </div>

                <!-- Login Form -->
                <div id="loginForm">
                    <h2 class="text-2xl font-bold mb-6 text-center">Sign in / เข้าสู่ระบบ</h2>
                    
                    <form onsubmit="handleLogin(event)">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2 text-gray-300">อีเมล</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <i data-lucide="mail" class="w-5 h-5"></i>
                                </span>
                                <input type="email" id="loginEmail" required
                                    class="w-full pl-11 pr-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"
                                    placeholder="your@email.com">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2 text-gray-300">รหัสผ่าน</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <i data-lucide="lock" class="w-5 h-5"></i>
                                </span>
                                <input type="password" id="loginPassword" required
                                    class="w-full pl-11 pr-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"
                                    placeholder="••••••••">
                            </div>
                        </div>

                        <div class="mb-6 flex items-center justify-between">
                            <div class="flex items-center">
                                 <input id="rememberMeCheckbox" name="rememberMe" type="checkbox" class="h-4 w-4 text-red-600 border-gray-600 rounded focus:ring-red-500 bg-gray-700">
                                 <label for="rememberMeCheckbox" class="ml-2 block text-sm text-gray-300">
                                             จำฉันไว้
                                </label>
                             </div>
                             <a href="#" onclick="openForgotModal(event)" class="text-sm text-red-400 hover:text-red-300">ลืมรหัสผ่าน?</a>
                        </div>

                        <button type="submit" class="w-full gradient-button text-white font-semibold py-3 rounded-lg">
                            เข้าสู่ระบบ
                        </button>
                    </form>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="hidden">
                    <h2 class="text-2xl font-bold mb-6 text-center">Register / สมัครสมาชิก</h2>
                    
                    <form onsubmit="handleRegister(event)">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2 text-gray-300">ชื่อผู้ใช้</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <i data-lucide="user" class="w-5 h-5"></i>
                                </span>
                                <input type="text" id="registerUsername" required
                                    class="w-full pl-11 pr-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"
                                    placeholder="Username">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2 text-gray-300">อีเมล</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <i data-lucide="mail" class="w-5 h-5"></i>
                                </span>
                                <input type="email" id="registerEmail" required
                                    class="w-full pl-11 pr-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"
                                    placeholder="your@email.com">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2 text-gray-300">รหัสผ่าน</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <i data-lucide="lock" class="w-5 h-5"></i>
                                </span>
                                <input type="password" id="registerPassword" required minlength="6"
                                    class="w-full pl-11 pr-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"
                                    placeholder="••••••••">
                            </div>
                            <p class="text-xs text-gray-400 mt-1">รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร</p>
                        </div>

                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2 text-gray-300">ยืนยันรหัสผ่าน</label>
                            <div class="relative">
                                <span class="absolute left-3 top-3 text-gray-400">
                                    <i data-lucide="lock" class="w-5 h-5"></i>
                                </span>
                                <input type="password" id="registerConfirmPassword" required minlength="6"
                                    class="w-full pl-11 pr-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400"
                                    placeholder="••••••••">
                            </div>
                        </div>

                        <button type="submit" class="w-full gradient-button text-white font-semibold py-3 rounded-lg">
                            สมัครสมาชิก
                            
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- FORGOT PASSWORD MODAL -->
    <div id="forgotModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center px-4">
        <div class="glass-card rounded-2xl p-8 w-full max-w-md relative">
            <button onclick="closeForgotModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <div id="step1">
                <h2 class="text-2xl font-bold mb-4 text-center">ลืมรหัสผ่าน</h2>
                <p class="text-gray-300 text-sm mb-6 text-center">กรอกอีเมลเพื่อรับรหัสยืนยัน</p>
                <form onsubmit="sendCode(event)">
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2 text-gray-300">อีเมล</label>
                        <input type="email" id="forgotEmail" required
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white">
                    </div>
                    <button type="submit" class="w-full gradient-button text-white font-semibold py-3 rounded-lg">
                        ส่งรหัส
                    </button>
                </form>
            </div>

            <div id="step2" class="hidden">
                <h2 class="text-2xl font-bold mb-4 text-center">ใส่รหัสยืนยัน</h2>
                <p class="text-sm mb-2 text-center">รหัส: <span id="showCode" class="text-red-400 font-bold text-xl"></span></p>
                <p class="text-xs text-gray-400 mb-6 text-center">(จำลอง - ปกติส่งทางอีเมล)</p>
                <form onsubmit="verifyCode(event)">
                    <div class="mb-6">
                        <input type="text" id="codeInput" required maxlength="6" pattern="[0-9]{6}"
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white text-center text-2xl"
                            placeholder="000000">
                    </div>
                    <button type="submit" class="w-full gradient-button text-white font-semibold py-3 rounded-lg">
                        ยืนยัน
                    </button>
                </form>
            </div>

            <div id="step3" class="hidden">
                <h2 class="text-2xl font-bold mb-4 text-center">ตั้งรหัสผ่านใหม่</h2>
                <form onsubmit="resetPass(event)">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2 text-gray-300">รหัสผ่านใหม่</label>
                        <input type="password" id="newPass" required minlength="6"
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2 text-gray-300">ยืนยันรหัสผ่าน</label>
                        <input type="password" id="confirmPass" required minlength="6"
                            class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white">
                    </div>
                    <button type="submit" class="w-full gradient-button text-white font-semibold py-3 rounded-lg">
                        บันทึก
                    </button>
                </form>
            </div>
        </div>
    </div>

<script>
    // Initialize Lucide icons
    lucide.createIcons();

 // -----------------------------------------------------------
// 1. Storage Functions: ใช้ LocalStorage แทน In-memory database
// -----------------------------------------------------------

const STORAGE_KEY = 'app_users';

function loadUsers() {
    const usersJSON = localStorage.getItem(STORAGE_KEY);
    const defaultUsers = {
        // เพิ่มผู้ใช้ Demo หากไม่มีข้อมูลใน LocalStorage
        'demo@test.com': { 
            username: 'Demo User', 
            password: 'demo123', 
            email: 'demo@test.com',
            joinDate: '2023-01-01T00:00:00.000Z' // <<-- เพิ่มวันที่เริ่มต้นสำหรับ DEMO
        }
    };
    
    // ใช้ข้อมูลจาก LocalStorage ถ้ามี มิฉะนั้นใช้ข้อมูลเริ่มต้น
    let loadedUsers = usersJSON ? JSON.parse(usersJSON) : {};
    
    // ตรวจสอบให้แน่ใจว่าผู้ใช้ Demo ยังอยู่ ถ้าไม่มีข้อมูลใน LocalStorage
    if (!usersJSON || Object.keys(loadedUsers).length === 0) {
        loadedUsers = defaultUsers;
    }

    return loadedUsers;
}

function saveUsers(users) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
}

// โหลดผู้ใช้เมื่อเริ่มต้น
let users = loadUsers();
    // -----------------------------------------------------------
    // 2. Cookie Functions: สำหรับจัดการ Remember Me
    // -----------------------------------------------------------

    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/; samesite=Lax";
    }

    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i=0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function eraseCookie(name) {   
        document.cookie = name +'=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    }

    // -----------------------------------------------------------
    // 3. UI and Logic
    // -----------------------------------------------------------

    let currentTab = 'login'; // ตัวแปรสำหรับเก็บสถานะ Tab ปัจจุบัน

    // Switch between login and register tabs
    function switchTab(tab) {
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const alertBox = document.getElementById('alertBox');

        alertBox.classList.add('hidden');
        
        currentTab = tab; // บันทึกสถานะ Tab ที่ถูกคลิก

        if (tab === 'login') {
            loginTab.classList.add('tab-active');
            loginTab.classList.remove('tab-inactive');
            registerTab.classList.remove('tab-active');
            registerTab.classList.add('tab-inactive');
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
        } else {
            registerTab.classList.add('tab-active');
            registerTab.classList.remove('tab-inactive');
            loginTab.classList.remove('tab-active');
            loginTab.classList.add('tab-inactive');
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        }
    }

    // Show alert message
    function showAlert(message, type) {
        const alertBox = document.getElementById('alertBox');
        alertBox.className = 'alert mb-4 p-4 rounded-lg';
        
        if (type === 'success') {
            alertBox.classList.add('bg-green-600', 'text-white');
        } else {
            alertBox.classList.add('bg-red-600', 'text-white');
        }
        
        alertBox.textContent = message;
        alertBox.classList.remove('hidden');

        setTimeout(() => {
            alertBox.classList.add('hidden');
        }, 3000);
    }

    // Handle registration
function handleRegister(e) {
    e.preventDefault();
    
    const username = document.getElementById('registerUsername').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;


    // Validation
    if (password !== confirmPassword) {
        showAlert('รหัสผ่านไม่ตรงกัน กรุณาลองใหม่อีกครั้ง', 'error');
        return;
    }

    if (users[email]) {
        showAlert('อีเมลนี้ถูกใช้งานแล้ว กรุณาใช้อีเมลอื่น', 'error');
        return;
    }

    // Save user (In real app, password should be Hashed!)
    users[email] = {
        username: username,
        password: password,
        email: email,
        joinDate: new Date().toISOString() // <<-- NEW: บันทึกวันที่ปัจจุบัน
    };
    saveUsers(users); // บันทึกข้อมูลผู้ใช้ใหม่ลง LocalStorage

    showAlert('สมัครสมาชิกสำเร็จ! กรุณาเข้าสู่ระบบ', 'success');
    
    // Clear form
    document.getElementById('registerUsername').value = '';
    document.getElementById('registerEmail').value = '';
    document.getElementById('registerPassword').value = '';
    document.getElementById('registerConfirmPassword').value = '';

    // Switch to login tab after 1.5 seconds
    setTimeout(() => {
        switchTab('login');
    }, 1500);
}
    // Handle login
    function handleLogin(e) {
        e.preventDefault();
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        // Checkbox for Remember Me
        const rememberMe = document.getElementById('rememberMeCheckbox') ? document.getElementById('rememberMeCheckbox').checked : false; 

        // Check credentials
        if (!users[email]) {
            showAlert('ไม่พบอีเมลนี้ในระบบ กรุณาสมัครสมาชิกก่อน', 'error');
            return;
        }

        if (users[email].password !== password) {
            showAlert('รหัสผ่านไม่ถูกต้อง กรุณาลองใหม่อีกครั้ง', 'error');
            return;
        }

        // Login successful
        // บันทึกข้อมูลผู้ใช้ที่ล็อกอินสำเร็จลง LocalStorage
        const loggedInUser = users[email];
        localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));

        if (rememberMe) {
            // Set a persistent cookie (e.g., for 30 days)
            setCookie('user_session_token', email, 30); 
            console.log('Remember Me set! Cookie saved for 30 days.');
        } else {
            // Clear persistent cookie
            eraseCookie('user_session_token'); 
        }

        showAlert('เข้าสู่ระบบสำเร็จ! กำลังนำคุณไปยังหน้าหลัก...', 'success');
        
        // Redirect to homepage after 1.5 seconds
        setTimeout(() => {
            window.location.href = 'homepage.html'; 
        }, 1500);
    }

    // -----------------------------------------------------------
    // 4. Auto-Login Check on Page Load
    // -----------------------------------------------------------
    function checkAutoLogin() {
        const sessionToken = getCookie('user_session_token');
        
        // ถ้ามี Token และผู้ใช้มีอยู่จริง ให้ Auto-login
        if (sessionToken && users[sessionToken]) {
            // บันทึกข้อมูลผู้ใช้ที่ล็อกอินสำเร็จลง LocalStorage เมื่อ Auto-login
            const loggedInUser = users[sessionToken];
            localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));

            showAlert(`ยินดีต้อนรับกลับมา, ${users[sessionToken].username}!`, 'success');
            console.log('Auto-login successful via cookie!');
            
            setTimeout(() => {
                window.location.href = 'homepage.html';
            }, 1000);
        }
    }

    // -----------------------------------------------------------
    // 5. FORGOT PASSWORD FUNCTIONS
    // -----------------------------------------------------------
    let tempEmail = '';
    let tempCode = '';

    function openForgotModal(e) {
        e.preventDefault();
        document.getElementById('forgotModal').classList.remove('hidden');
        document.getElementById('step1').classList.remove('hidden');
        document.getElementById('step2').classList.add('hidden');
        document.getElementById('step3').classList.add('hidden');
        setTimeout(() => lucide.createIcons(), 100);
    }

    function closeForgotModal() {
        document.getElementById('forgotModal').classList.add('hidden');
        tempEmail = '';
        tempCode = '';
    }

    function sendCode(e) {
        e.preventDefault();
        const email = document.getElementById('forgotEmail').value;
        
        if (!users[email]) {
            showAlert('ไม่พบอีเมลนี้ในระบบ', 'error');
            return;
        }
        
        tempEmail = email;
        tempCode = Math.floor(100000 + Math.random() * 900000).toString();
        document.getElementById('showCode').textContent = tempCode;
        
        document.getElementById('step1').classList.add('hidden');
        document.getElementById('step2').classList.remove('hidden');
    }

    function verifyCode(e) {
        e.preventDefault();
        const code = document.getElementById('codeInput').value;
        
        if (code !== tempCode) {
            showAlert('รหัสไม่ถูกต้อง', 'error');
            return;
        }
        
        document.getElementById('step2').classList.add('hidden');
        document.getElementById('step3').classList.remove('hidden');
        setTimeout(() => lucide.createIcons(), 100);
    }

    function resetPass(e) {
        e.preventDefault();
        const newPass = document.getElementById('newPass').value;
        const confirmPass = document.getElementById('confirmPass').value;
        
        if (newPass !== confirmPass) {
            showAlert('รหัสผ่านไม่ตรงกัน', 'error');
            return;
        }
        
        users[tempEmail].password = newPass;
        saveUsers(users);
        
        showAlert('เปลี่ยนรหัสผ่านสำเร็จ!', 'success');
        closeForgotModal();
    }

    // Run auto-login check when the page is fully loaded
    window.onload = checkAutoLogin;
 </script>


</body>
</html>